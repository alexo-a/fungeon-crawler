(this["webpackJsonpfungeon-crawler"]=this["webpackJsonpfungeon-crawler"]||[]).push([[0],{17:function(t,e,n){},18:function(t,e,n){},19:function(t,e,n){"use strict";n.r(e);var i=n(0),a=n(2),o=n.n(a),s=n(10),r=n.n(s),c=(n(17),n(18),n(4));var u=function(t){var e=t.x,n=t.y,a=t.classNames,o=t.handleClick,s=t.hitpointsRemainingDecimal,r="undefined"===typeof s?"0":Math.round(10*s),c="undefined"===typeof s?"0":(10*(10-r)).toString();return Object(i.jsxs)("div",{className:a,onClick:function(t){o(t)},x:e,y:n,children:[Object(i.jsxs)("div",{className:"hitpointsBar",children:[Object(i.jsx)("div",{className:"hitpointsRemaining w".concat((10*r).toString())}),Object(i.jsx)("div",{className:"hitpointsLost w".concat(c)})]}),Object(i.jsx)("div",{className:"img-loc"})]})},h=n(11),m=n(1),l=n(9),p="MOVE_ENTITY",v="TOGGLE_MOVEMENT_MODE",d="END_TURN",g="TOGGLE_ATTACK_MODE",b=function(t,e){switch(e.type){case p:var n=Object(l.a)(t.entities),i=t.entities[t.whoseTurn],a=!0;return i.position=e.newPosition,i.movementRemaining=e.movementRemaining,n[t.whoseTurn]=i,0===i.movementRemaining&&(a=!1),Object(m.a)(Object(m.a)({},t),{},{entities:n,movementMode:a});case"FORCE_RENDER":return Object(m.a)(Object(m.a)({},t),{},{forceRender:e.forceRender});case v:var o;return"undefined"===typeof e.setMovement?(o=t.movementMode,t.entities[t.whoseTurn].movementRemaining>0&&(o=!o)):o=e.setMovement,Object(m.a)(Object(m.a)({},t),{},{movementMode:o});case g:var s;return s="undefined"===typeof e.setAttackMode?!t.attackMode:e.setAttackMode,Object(m.a)(Object(m.a)({},t),{},{attackMode:s});case d:console.log("end of ".concat(t.entities[t.whoseTurn].name,"'s turn"));var r=Object(l.a)(t.entities),c=0;if(t.whoseTurn<t.entities.length-1&&(c=t.whoseTurn+1),console.log("start of ".concat(t.entities[c].name,"'s turn")),0===c)for(var u=0;u<r.length;u++)r[u].movementRemaining=r[u].speed;return Object(m.a)(Object(m.a)({},t),{},{movementMode:!1,whoseTurn:c,entities:0===c?r:t.entities,round:0===c?t.round++:t.round});case"UPDATE_ENTITY_STATS":var h=t;return h[e.entityIndex]=e.entity,Object(m.a)({},h);default:return t}};function y(t){switch(t){case 100:return Math.ceil(100*Math.random());case 20:return Math.ceil(20*Math.random());case 12:return Math.ceil(12*Math.random());case 10:return Math.ceil(10*Math.random());case 8:return Math.ceil(8*Math.random());case 6:return Math.ceil(6*Math.random());case 4:return Math.ceil(4*Math.random());default:alert("".concat(t," isn't a valid dice option"))}}function j(t,e){return Math.floor(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)))}function f(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.name=t,this.isNPC=e,this.activeGear={}}f.prototype.getStats=function(){return{maxHitpoints:this.maxHitpoints,currentHitpoints:this.currentHitpoints,initiative:this.initiative,speed:this.speed,armor:this.armor,hitBonus:this.hitBonus,visibilityRange:this.visibilityRange,sneakBonus:this.sneakBonus,trapDisableBonus:this.trapDisableBonus,agility:this.agility,movementRemaining:this.movementRemaining,position:this.position,activeWeapon:this.activeWeapon,equippedGear:this.equippedGear}},f.prototype.setStats=function(t){this.currentHitpoints=t.currentHitpoints||15,this.maxHitpoints=t.maxHitpoints||15,this.initiative=t.initiative||0,this.speed=t.speed||5,this.armor=t.armor||12,this.hitBonus=t.hitBonus||0,this.visibilityRange=t.visibilityRange||10,this.sneakBonus=t.sneakBonus||0,this.trapDisableBonus=t.trapDisableBonus||0,this.agility=t.agility||0,this.chanceToFlee=t.chanceToFlee||5,this.aggroRange=t.aggroRange||2},f.prototype.setMovementRemaining=function(t){this.movementRemaining=t||this.speed},f.prototype.setInventory=function(t){return this.inventory=t,this.inventory},f.prototype.getInventory=function(){return!!this.inventory.length&&this.inventory},f.prototype.equipWeapon=function(t){for(var e=0;e<this.inventory.length;e++)if(this.inventory[e].name===t.name&&this.inventory[e].quantity>=1){"weapon"===t.class&&(this.activeWeapon=t);break}},f.prototype.equipGear=function(t){for(var e=0;e<this.inventory.length;e++)if(this.inventory[e].name===t.name&&this.inventory[e].quantity>=1)switch(t.class){case"torso":this.activeGear.torso=t;break;case"neck":this.activeGear.neck=t;break;case"head":this.activeGear.head=t;break;case"hands":this.activeGear.hands=t;break;case"back":this.activeGear.back=t;break;default:alert("not an active gear item. needs to be of class torso/neck/head/hands/back")}},f.prototype.getWeapon=function(){return this.activeWeapon},f.prototype.getHitpoints=function(){return"".concat(this.name,"'s health is now ").concat(this.currentHitpoints,"!")},f.prototype.isAlive=function(){return!(this.currentHitpoints<=0)},f.prototype.reduceHitpoints=function(t){this.currentHitpoints-=t,this.currentHitpoints=Math.max(this.currentHitpoints,0)},f.prototype.getAttackValue=function(){var t=this.strength-5,e=this.strength+5;return Math.floor(Math.random()*(e-t)+t)},f.prototype.addPotion=function(t){this.inventory.push(t)},f.prototype.usePotion=function(t){},f.prototype.getPosition=function(){return this.getPosition},f.prototype.setPosition=function(t){this.position=t},f.prototype.getName=function(){return this.name},f.prototype.willFlee=function(){return this.currentHitpoints<this.maxHitpoints&&this.currentHitpoints/this.maxHitpoints<=.5&&y(20)<=this.chanceToFlee};var w=f,O=n(3),x=n.n(O),M=Object(a.createContext)(),k=M.Provider,T=new w("Geraldo");T.setStats({speed:5,hitBonus:2,isNPC:!1}),T.setPosition({x:9,y:9}),T.setInventory([Object(m.a)(Object(m.a)({},x.a.gold),{},{quantity:150}),Object(m.a)(Object(m.a)({},x.a.shortbow),{},{quantity:1})]),T.setMovementRemaining(),T.equipWeapon(x.a.shortbow);var R=new w("Boblin");R.setStats({speed:5,isNPC:!0}),R.setPosition({x:4,y:4}),R.setInventory([Object(m.a)(Object(m.a)({},x.a.gold),{},{quantity:150}),Object(m.a)(Object(m.a)({},x.a.shortsword),{},{quantity:1}),Object(m.a)(Object(m.a)({},x.a.godCape),{},{quantity:1}),Object(m.a)(Object(m.a)({},x.a.worthlessCape),{},{quantity:1})]),R.setMovementRemaining(),R.equipWeapon(x.a.shortsword),R.equipGear(x.a.godCape),R.equipGear(x.a.worthlessCape);var H=function(t){t.value;var e,n=Object(h.a)(t,["value"]),o=(e={entities:[T,R],whoseTurn:0,movementMode:!1,round:0,attackMode:!1},Object(a.useReducer)(b,e)),s=Object(c.a)(o,2),r=s[0],u=s[1];return Object(i.jsx)(k,Object(m.a)({value:[r,u]},n))},q=function(){return Object(a.useContext)(M)};var N=function(t){var e=t.gridSize,n=void 0===e?10:e,a=[],o=q(),s=Object(c.a)(o,2),r=s[0],h=s[1],m=0===r.whoseTurn,l=r.entities[0].movementRemaining>0,v=r.entities[0],d=[];function b(t,e){return t.x===e.x&&t.y===e.y}for(var f=0;f<r.entities.length;f++)0!==f?d.push(r.entities[f].position):d.push({x:null,y:null});for(var w=function(t){var e={x:parseInt(t.target.getAttribute("x")||t.target.parentElement.getAttribute("x")),y:parseInt(t.target.getAttribute("y")||t.target.parentElement.getAttribute("y"))};if(r.movementMode){console.log("".concat(r.entities[r.whoseTurn].name," is attempting to move to (").concat(e.x,", ").concat(e.y,")"));var n=j({x:e.x,y:e.y},r.entities[r.whoseTurn].position);if(r.entities[r.whoseTurn].movementRemaining>=n){for(var i=!0,a=0;a<r.entities.length;a++)if(b(e,r.entities[a])){i=!1;break}i?(console.log("move was successful"),h({type:p,newPosition:{x:e.x,y:e.y},movementRemaining:r.entities[r.whoseTurn].movementRemaining-n})):console.log("move didn't work")}}else if(r.attackMode){var o=!1,s=null;console.log("attempting to attack mob at ".concat(e.x,", ").concat(e.y));for(var u=0;u<d.length;u++)b(d[u],e)&&(s=u,o=!0);(o=o&&j(e,r.entities[0].position)<=r.entities[0].activeWeapon.range)&&(console.log("attack was valid"),function(t,e){var n=y(20);console.log("".concat(t.name,"'s raw hit roll: ").concat(n));for(var i=t.hitBonus+t.agility+n,a=0,o=0,s=Object.entries(e.activeGear);o<s.length;o++){var r=Object(c.a)(s[o],2);r[0],a+=r[1].armor}var u=e.armor+a;if(console.log("".concat(t.name," rolls a ").concat(i," vs. ").concat(e.name,"'s armor of ").concat(u)),i>=u){var h=y(t.activeWeapon.damage);e.reduceHitpoints(h),console.log("attack hit! ".concat(t.name," does ").concat(h," damage. ").concat(e.getHitpoints())),e.isAlive()||console.log("".concat(e.name," died :("))}else console.log("**whoosh** (attack missed)")}(r.entities[0],r.entities[s]),h({type:g,setAttackMode:!1}))}},O=0;O<n;O++){a.push([]);for(var x=0;x<n;x++){var M=void 0,k="square";b(v.position,{x:x,y:O})?(k="square activePlayer",M=r.entities[0].currentHitpoints/r.entities[0].maxHitpoints):m&&l&&j({x:x,y:O},v.position)<=v.movementRemaining&&r.movementMode&&(k="square green");for(var T=0;T<d.length;T++)b(d[T],{x:x,y:O})&&(0===r.whoseTurn&&r.attackMode&&j({x:x,y:O},v.position)<=v.activeWeapon.range?(k="square mob red-background",M=r.entities[T].currentHitpoints/r.entities[T].maxHitpoints):r.entities[T].isAlive()?(k="square mob",M=r.entities[T].currentHitpoints/r.entities[T].maxHitpoints):k="square dead-mob");a[O].push(Object(i.jsx)(u,{x:x,y:O,classNames:k,handleClick:function(t){w(t)},hitpointsRemainingDecimal:M},x.toString()+O.toString()))}}return Object(i.jsx)(i.Fragment,{children:a.map((function(t,e){return Object(i.jsx)("div",{className:"map-row",children:t.map((function(t){return t}))},"row"+e.toString())}))})};var A=function(t){var e=t.playerIndex,n=q(),a=Object(c.a)(n,2),o=a[0],s=a[1];return Object(i.jsxs)("div",{className:"footer",children:[Object(i.jsx)("div",{children:e===o.whoseTurn?"Your Turn!":"Their turn, please wait."}),o.whoseTurn===e?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{children:"".concat(o.entities[o.whoseTurn].name," has ").concat(o.entities[o.whoseTurn].movementRemaining," movement remaining")}),Object(i.jsx)("button",{className:o.entities[o.whoseTurn].movementRemaining>0?"":"disabled",onClick:function(){s({type:v})},children:o.movementMode?"Moving":"Move"}),Object(i.jsx)("button",{onClick:function(){s({type:v,setMovement:!1}),s({type:g})},children:o.attackMode?"ATTACKING!!":"Attack"}),Object(i.jsx)("button",{onClick:function(){s({type:d})},children:"End Turn"})]}):null]})},C=n(8),E=n.n(C);var G=function(){var t=q(),e=Object(c.a)(t,2),n=e[0];if(e[1],0!==n.whoseTurn)n.entities[n.whoseTurn];return E()(".square").css("height","min(10vw, calc((100vh - 100px)/".concat(15,"))")),E()(".square").css("width","min(10vw, calc((100vh - 100px)/".concat(15,"))")),Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{className:"game",children:Object(i.jsx)("div",{className:"Map",children:Object(i.jsx)(N,{gridSize:15})})}),Object(i.jsx)(A,{playerIndex:0})]})};var B=function(){return Object(i.jsx)("div",{className:"App",children:Object(i.jsxs)(H,{children:[Object(i.jsx)("header",{className:"App-header"}),Object(i.jsx)(G,{})]})})};r.a.render(Object(i.jsx)(o.a.StrictMode,{children:Object(i.jsx)(B,{})}),document.getElementById("root"))},3:function(t,e){t.exports={gold:{name:"gold",class:"money",weight:.01,value:1},shortsword:{name:"shortsword",class:"weapon",weight:2,damage:6,value:20,range:1},shortbow:{name:"shortbow",class:"weapon",weight:2,damage:6,value:15,range:5},leatherArmor:{name:"leatherArmor",class:"torso",weight:7,armor:2,value:15},defenseAmulet:{name:"defenseAmulet",class:"neck",weight:.5,armor:1,value:150},godCape:{name:"godCape",class:"back",weight:9,armor:99,value:1},worthlessCape:{name:"worthlessCape",class:"back",weight:9,armor:0,value:1}}}},[[19,1,2]]]);
//# sourceMappingURL=main.8401c99d.chunk.js.map